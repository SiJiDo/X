# -*- encoding: utf-8 -*-
from email.policy import default
from time import time
from xml.dom.expatbuilder import ExpatBuilder
from apps import db
from sqlalchemy.dialects.mysql import LONGTEXT
from sqlalchemy.sql.sqltypes import Boolean


#漏洞基本信息
class ExpInfo(db.Model):

    __tablename__ = 'ExpInfo'

    id            = db.Column(db.Integer, autoincrement=True, primary_key=True)
    expName       = db.Column(db.String(256), unique=True)              #漏洞名称
    expLdap       = db.Column(Boolean, default = False)                 #是否是反序列化漏洞
    
    def __init__(self, expName, expLdap):
        self.expName = expName
        self.expLdap = expLdap

#服务器基本信息
class ExpAttack(db.Model):

    __tablename__ = 'ExpAttack'

    id            = db.Column(db.Integer, autoincrement=True, primary_key=True)
    url           = db.Column(db.string(256))       #目标url
    expId         = db.Column(db.Integer)           #exp的id
    userId        = db.Column(db.Integer)           #当前调用的userid
    serverRole    = db.Column(db.string(256))       #获取服务器角色 whoami
    serverOS      = db.Column(db.string(256))       #获取服务器操作系统 systeminfo， cat /proc/version
    servernet     = db.Column(db.string(256))       #获取是否出网 ping -c 8.8.8.8
    serverdefiner = db.Column(db.string(256))       #获取杀软信息
    serverDC      = db.Column(db.string(256))       #获取是否在域内，在net user /domain
    serverpath    = db.Column(db.string(256))       #存马的位置

    def __init__(self, url):
        self.url = url

#漏洞执行日志信息
class ExpLog(db.Model):
    
    __tablename__ = 'ExpLog'

    id            = db.Column(db.Integer, autoincrement=True, primary_key=True)
    exprequest    = db.Column(db.String(1024))                 #日志的request请求
    expresponse   = db.Column(db.String(1024))                 #日志的response结果
    expid         = db.Column(db.Integer, default=0)    #当然产生日志的exp
    userid        = db.Column(db.Integer, default=0)    #当前产生日志的用户
    time          = db.Column(db.string(256))           #执行时间，方便排序

    def __init__(self, exprequest, expresponse, expid, userid):
        self.exprequest = exprequest
        self.expresponse = expresponse
        self.expid = expid
        self.userid = userid