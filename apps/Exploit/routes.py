# -*- encoding: utf-8 -*-
"""
Copyright (c) 2019 - present AppSeed.us
"""

from apps.home import blueprint
from flask import render_template
from flask_login import login_required
from apps.Exploit.forms import ExpSettingForm, LogForm
from apps import db
from apps import utils
from apps.plugins.models import AttackServer


@blueprint.route('/Exploit', methods=['GET', 'POST'])
@login_required
def Exploit():
    expSettingForm = ExpSettingForm()
    logForm = LogForm()

    query = db.session.query(AttackServer).filter(AttackServer.model == "JNDIExpolit").first()
    jndiExpolit = utils.queryToDict(query)
    ldapAddr = "ldap://" + jndiExpolit["serverhost"] + ":" + jndiExpolit["serverport"].split(",")[0]
    expSettingDic = {"headConfig": "user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15\ncookie: xxx",
                    "ldapAddr": ldapAddr,
                    }
    utils.dict_to_form(expSettingDic, expSettingForm)  

    return render_template('Exp/Exploit.html', segment='Exploit', form={}, attacklist = utils.get_list(), expSettingForm = expSettingForm, logForm = logForm,)


@blueprint.route('/AddExp', methods=['GET', 'POST'])
@login_required
def AddExp():
    return render_template('Exp/AddExp.html', segment='AddExp', form={}, attacklist = utils.get_list())